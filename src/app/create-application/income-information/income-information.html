<div class="income-container">
  <div class="header-section">
    <h2>Income Information</h2>
    <p class="instructions">
      Provide income details for each household member. Select a pay frequency to enter income.
    </p>
  </div>

  <div class="example-action-buttons">
    <button mat-button (click)="expandAll()">Expand All</button>
    <button mat-button (click)="collapseAll()">Collapse All</button>
  </div>

  <mat-accordion class="example-headers-align" multi #accordion>
    <form [formGroup]="incomeForm">
      <div formArrayName="householdMembers">
        <mat-expansion-panel *ngFor="let memberGroup of householdIncomes.controls; let i = index" [formGroupName]="i">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ getMemberDisplayName(i) }}
            </mat-panel-title>
            <mat-panel-description>
              DOB: {{ getMemberDOB(i) }} | Age: {{ getMemberAge(i) }} | Total Income: {{
                getMemberTotalIncome(i) | currency:'USD':'symbol':'1.2-2' }}
            </mat-panel-description>
          </mat-expansion-panel-header>

          <div class="income-entry-grid">
            <!-- Frequency Dropdown in its own container -->
            <div class="frequency-container">
              <mat-form-field appearance="outline" class="frequency-field">
                <mat-label>Pay Frequency</mat-label>
                <mat-select formControlName="payFrequency">
                  <mat-option *ngFor="let freq of payFrequencies" [value]="freq.value">
                    {{ freq.viewValue }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Pay and Date Pairs -->
            <div class="pay-date-pair" *ngIf="isPayFieldVisible(i, 1)">
              <mat-form-field appearance="outline" class="pay-field">
                <mat-label>Pay 1</mat-label>
                <span matPrefix>$</span>
                <input matInput type="number" formControlName="pay1" placeholder="0.00">
              </mat-form-field>
              <mat-form-field appearance="outline" class="date-field">
                <mat-label>Date 1</mat-label>
                <input matInput formControlName="date1" placeholder="MM/DD/YYYY">
              </mat-form-field>
            </div>

            <div class="pay-date-pair" *ngIf="isPayFieldVisible(i, 2)">
              <mat-form-field appearance="outline" class="pay-field">
                <mat-label>Pay 2</mat-label>
                <span matPrefix>$</span>
                <input matInput type="number" formControlName="pay2" placeholder="0.00">
              </mat-form-field>
              <mat-form-field appearance="outline" class="date-field">
                <mat-label>Date 2</mat-label>
                <input matInput formControlName="date2" placeholder="MM/DD/YYYY">
              </mat-form-field>
            </div>

            <div class="pay-date-pair" *ngIf="isPayFieldVisible(i, 3)">
              <mat-form-field appearance="outline" class="pay-field">
                <mat-label>Pay 3</mat-label>
                <span matPrefix>$</span>
                <input matInput type="number" formControlName="pay3" placeholder="0.00">
              </mat-form-field>
              <mat-form-field appearance="outline" class="date-field">
                <mat-label>Date 3</mat-label>
                <input matInput formControlName="date3" placeholder="MM/DD/YYYY">
              </mat-form-field>
            </div>

            <div class="pay-date-pair" *ngIf="isPayFieldVisible(i, 4)">
              <mat-form-field appearance="outline" class="pay-field">
                <mat-label>Pay 4</mat-label>
                <span matPrefix>$</span>
                <input matInput type="number" formControlName="pay4" placeholder="0.00">
              </mat-form-field>
              <mat-form-field appearance="outline" class="date-field">
                <mat-label>Date 4</mat-label>
                <input matInput formControlName="date4" placeholder="MM/DD/YYYY">
              </mat-form-field>
            </div>

            <div class="pay-date-pair" *ngIf="isPayFieldVisible(i, 5)">
              <mat-form-field appearance="outline" class="pay-field">
                <mat-label>Pay 5</mat-label>
                <span matPrefix>$</span>
                <input matInput type="number" formControlName="pay5" placeholder="0.00">
              </mat-form-field>
              <mat-form-field appearance="outline" class="date-field">
                <mat-label>Date 5</mat-label>
                <input matInput formControlName="date5" placeholder="MM/DD/YYYY">
              </mat-form-field>
            </div>

          </div>

        </mat-expansion-panel>
      </div>
    </form>
  </mat-accordion>

  <div class="form-actions">
    <button mat-stroked-button (click)="onBack()" class="back-btn">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
    <button mat-raised-button color="accent" (click)="onSaveAndContinue()" [disabled]="incomeForm.invalid"
      class="continue-btn">
      Save and Continue
      <mat-icon>arrow_forward</mat-icon>
    </button>
  </div>
</div>
